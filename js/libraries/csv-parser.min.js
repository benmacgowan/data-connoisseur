var isDecimal_re=/^\s*(\+|-)?((\d+([,\.]\d+)?)|([,\.]\d+))\s*$/,CSVParser={isNumber:function(r){return null==r||isNaN(new Number(r))?!1:!0},parse:function(r,e,n,t,a,g){var o=[],i=new RegExp("[^,]","gi"),l=r.replace(i,"").length;i=new RegExp("[^	]","gi");var s=r.replace(i,"").length,h="\n",p=",";s>l&&(p="	"),"comma"===n?p=",":"tab"===n&&(p="	"),i=new RegExp("^"+h+"+","gi"),r=r.replace(i,""),i=new RegExp(h+"+$","gi"),r=r.replace(i,""),o=this.CSVToArray(r,p);for(var f=o.length-1;f>=0;f--)for(var c=o[f].length-1;c>=0;c--)o[f][c]=o[f][c].replace("	","\\t"),o[f][c]=o[f][c].replace("\n","\\n"),o[f][c]=o[f][c].replace("\r","\\r");var u=[],v=[],m=o[0].length,L=o.length;if(e)u=o.splice(0,1)[0],L=o.length;else for(var f=0;m>f;f++)u.push("val"+String(f)),v.push("");if(a)for(var f=u.length-1;f>=0;f--)u[f]=u[f].toUpperCase();if(t)for(var f=u.length-1;f>=0;f--)u[f]=u[f].toLowerCase();for(var f=0;f<o.length;f++){var w=o[f].length;w!=m&&this.log("Error parsing row "+String(f)+". Wrong number of columns.")}for(var d=o.length,x=.9,f=0;f<u.length;f++){for(var E=0,S=0,C=0;d>C;C++)o[C]&&((g="comma"&&isDecimal_re.test(o[C][f]))&&(o[C][f]=o[C][f].replace(",",".")),CSVParser.isNumber(o[C][f])&&(S++,String(o[C][f]).indexOf(".")>0&&E++));v[f]=S/d>x?E>0?"float":"int":"string"}return{dataGrid:o,headerNames:u,headerTypes:v,errors:this.getLog()}},errorLog:[],resetLog:function(){this.errorLog=[]},log:function(r){this.errorLog.push(r)},getLog:function(){var r="";if(this.errorLog.length>0)for(var e=0;e<this.errorLog.length;e++)r+="<li>"+this.errorLog[e]+"</li>";return r},CSVToArray:function(r,e){e=e||",";for(var n=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),t=[[]],a=null;a=n.exec(r);){var g=a[1];if(g.length&&g!=e&&t.push([]),a[2])var o=a[2].replace(new RegExp('""',"g"),'"');else var o=a[3];t[t.length-1].push(o)}return t}};